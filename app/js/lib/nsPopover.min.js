(function(q,g,F){var G=g.element,H=0,r=g.isDefined,w=g.module("nsPopover",[]);w.provider("nsPopover",function(){var q={angularEvent:null,container:"body",hideOnButtonClick:!0,hideOnInsideClick:!1,hideOnOutsideClick:!0,mouseRelative:"",onClose:g.noop,onOpen:g.noop,placement:"bottom|left",plain:"false",popupDelay:0,restrictBounds:!1,scopeEvent:null,template:"",theme:"ns-popover-list-theme",timeout:1.5,trigger:"click",triggerPrevent:!0};this.setDefaults=function(r){g.extend(q,r)};this.$get=function(){return{getDefaults:function(){return q}}}});
w.directive("nsPopover",["nsPopover","$rootScope","$timeout","$templateCache","$q","$http","$compile","$document","$parse",function(w,I,t,O,P,Q,R,x,B){return{restrict:"A",scope:!0,link:function(f,m,d){function S(){function a(){n.cancel()}function k(){n.hide(b.timeout)}m.on("mouseout",k).on("mouseover",a);e.on("mouseout",k).on("mouseover",a);J=function(){m.off("mouseout",k).off("mouseover",a);e.off("mouseout",k).off("mouseover",a)}}function K(){e.isOpen&&f.hidePopover()}function y(a){g.isObject(a)&&
!1!==b.triggerPrevent&&a.preventDefault();n.cancel();u.display(b.popupDelay,a)}function C(a){var b=document.documentElement||document.body.parentNode||document.body,p=r(q.pageXOffset)?q.pageXOffset:b.scrollLeft,b=r(q.pageYOffset)?q.pageYOffset:b.scrollTop;a=a.getBoundingClientRect();return p||b?{bottom:a.bottom+b,left:a.left+p,right:a.right+p,top:a.top+b,height:a.height,width:a.width}:a}function L(){e.isOpen&&f.hidePopover()}function T(a,c,p,h,e){var d,k=C(a[0]),g,f,l;d=function(){return"center"===
p?Math.round(h.left+h.width/2-k.width/2):"right"===p?h.right-k.width:h.left};g=function(){return"center"===p?Math.round(h.top+h.height/2-k.height/2):"bottom"===p?h.bottom-k.height:h.top};"top"===c?(f=h.top-k.height,l=d()):"right"===c?(f=g(),l=h.right):"bottom"===c?(f=h.bottom,l=d()):"left"===c&&(f=g(),l=h.left-k.width);!0===b.restrictBounds&&(d=C(v[0]),l=Math.max(d.left,l),g=l+k.width,g>d.width&&(l-=g-d.width));a.css("top",f.toString()+"px").css("left",l.toString()+"px");e&&e.length&&("top"===c||
"bottom"===c?(l=h.left+h.width/2-l,e.css("left",l.toString()+"px")):(f=h.top+h.height/2-f,e.css("top",f.toString()+"px")))}function M(a){function b(a){return a.id===c?!0:(a=g.element(a).parent()[0])?a.id===c?!0:b(a):!1}if(e.isOpen&&a.target!==m[0]){var c=e[0].id;b(a.target)||f.hidePopover()}}function z(a){return a=a&&0!==a.length?"true"==(""+a).toLowerCase():!1}var v,e,N,D,c=w.getDefaults(),u,n,b={angularEvent:d.nsPopoverAngularEvent||c.angularEvent,container:d.nsPopoverContainer||c.container,group:d.nsPopoverGroup,
hideOnButtonClick:z(d.nsPopoverHideOnButtonClick||c.hideOnButtonClick),hideOnInsideClick:z(d.nsPopoverHideOnInsideClick||c.hideOnInsideClick),hideOnOutsideClick:z(d.nsPopoverHideOnOutsideClick||c.hideOnOutsideClick),mouseRelative:d.nsPopoverMouseRelative,onClose:B(d.nsPopoverOnClose)||c.onClose,onOpen:B(d.nsPopoverOnOpen)||c.onOpen,placement:d.nsPopoverPlacement||c.placement,plain:z(d.nsPopoverPlain||c.plain),popupDelay:d.nsPopoverPopupDelay||c.popupDelay,restrictBounds:!!d.nsPopoverRestrictBounds||
c.restrictBounds,scopeEvent:d.nsPopoverScopeEvent||c.scopeEvent,template:d.nsPopoverTemplate||c.template,theme:d.nsPopoverTheme||c.theme,timeout:d.nsPopoverTimeout||c.timeout,trigger:d.nsPopoverTrigger||c.trigger,triggerPrevent:d.nsPopoverTriggerPrevent||c.triggerPrevent},E,J,A;b.mouseRelative&&(b.mouseRelativeX=-1!==b.mouseRelative.indexOf("x"),b.mouseRelativeY=-1!==b.mouseRelative.indexOf("y"));u={id_:F,display:function(a,c){!1!==B(d.nsPopover)(f)&&(t.cancel(u.id_),r(a)||(a=0),b.group&&I.$broadcast("ns:popover:hide",
b.group),u.id_=t(function(){if(!0!==e.isOpen){e.isOpen=!0;e.css("display","block");var a=C(m[0]);if(b.mouseRelative){var d=b.mouseRelativeY,a={bottom:a.bottom,height:a.height,left:a.left,right:a.right,top:a.top,width:a.width};b.mouseRelativeX&&(a.left=c.pageX,a.right=c.pageX,a.width=0);d&&(a.top=c.pageY,a.bottom=c.pageY,a.height=0)}T(e,E,D,a,N);S();if(!0===b.hideOnInsideClick)e.on("click",L);if(!0===b.hideOnOutsideClick)x.on("click",M);if(!0===b.hideOnButtonClick)m.on("click",K);b.onOpen(f)}},1E3*
a))},cancel:function(){t.cancel(u.id_)}};n={id_:F,hide:function(a){t.cancel(n.id_);"-1"!==a&&(r(a)||(a=1.5),n.id_=t(function(){e.off("click",L);x.off("click",M);m.off("click",K);e.isOpen=!1;u.cancel();e.css("display","none");J();b.onClose(f)},1E3*a))},cancel:function(){t.cancel(n.id_)}};v=x.find(b.container);v.length||(v=x.find("body"));c=b.placement.match(/^(top|bottom|left|right)$|((top|bottom)\|(center|left|right)+)|((left|right)\|(center|top|bottom)+)/);if(!c)throw Error('"'+b.placement+'" is not a valid placement or has an invalid combination of placements.');
E=c[6]||c[3]||c[1];D=c[7]||c[4]||c[2]||"center";H+=1;e=G('<div id="nspopover-'+H+'"></div>').addClass("ns-popover-"+E+"-placement").addClass("ns-popover-"+D+"-align").css("position","absolute").css("display","none");f.hidePopover=function(){n.hide(0)};f.$on("ns:popover:hide",function(a,c){b.group===c&&f.hidePopover()});f.$on("$destroy",function(){e.remove();A()});g.isString(b.angularEvent)?A=I.$on(b.angularEvent,y):g.isString(b.scopeEvent)?A=f.$on(b.scopeEvent,y):(m.on(b.trigger,y),A=function(){m.off(b.trigger,
y)});P.when(function(a,b){return a?g.isString(a)&&b?a:O.get(a)||Q.get(a,{cache:!0}):""}(b.template,b.plain)).then(function(a){g.isObject(a)&&(a=g.isString(a.data)?a.data:"");e.html(a);b.theme&&e.addClass(b.theme);R(e)(f);N=G(e[0].querySelectorAll(".triangle"));v.append(e)})}}}])})(window,window.angular);
